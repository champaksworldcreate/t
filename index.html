<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Programmer's Picnic â€” JavaScript Editor</title>

<style>
:root{
  --bg:#fff7e6;
  --card:#ffffff;
  --ink:#1f2937;
  --muted:#6b7280;
  --brand:#d97706;
  --brand2:#f59e0b;
  --border:#eadcc5;
  --shadow:0 18px 40px rgba(31,41,55,.14);
  --codebg:#0b1220;
  --codeink:#e5e7eb;
  --ok:#166534;
  --bad:#b91c1c;
  --mono:ui-monospace,Consolas,Menlo,monospace;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(180deg,var(--bg),#fff);
  color:var(--ink);
}
.wrap{max-width:1280px;margin:18px auto;padding:14px}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  box-shadow:var(--shadow);
}
.top{
  display:flex;align-items:center;justify-content:space-between;
  gap:12px;margin-bottom:12px
}
.brand{
  display:flex;align-items:center;gap:10px;font-weight:900
}
.logo{
  width:36px;height:36px;border-radius:12px;
  background:linear-gradient(180deg,var(--brand2),var(--brand));
  display:flex;align-items:center;justify-content:center;
  color:#111;font-weight:900
}
.btn{
  border:1px solid var(--border);
  background:#fff;
  border-radius:999px;
  padding:8px 14px;
  font-weight:800;
  cursor:pointer
}
.btn.primary{
  background:linear-gradient(180deg,var(--brand2),var(--brand));
  border:0
}
.grid{
  display:grid;
  grid-template-columns:1.2fr .8fr;
  gap:12px
}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.header{
  padding:12px;
  border-bottom:1px solid var(--border);
  display:flex;justify-content:space-between;align-items:center
}
.small{font-size:12px;color:var(--muted)}

.editor-wrap{display:grid;grid-template-columns:auto 1fr}
.gutter{
  background:#020617;color:#94a3b8;
  padding:12px 8px;
  text-align:right;
  user-select:none;
  font-family:var(--mono);
  font-size:14px;
  line-height:1.5;
  min-width:54px;
  overflow:hidden;
  white-space:pre;
}
.editor{
  background:var(--codebg);
  color:var(--codeink);
  border:0;
  outline:none;
  padding:12px;
  font-family:var(--mono);
  font-size:14px;
  line-height:1.5;
  resize:none;
  min-height:520px;
  white-space:pre;
  overflow:auto
}
.out{
  background:#020617;
  color:#e5e7eb;
  border-radius:14px;
  padding:12px;
  font-family:var(--mono);
  font-size:13px;
  min-height:260px;
  white-space:pre-wrap;
  word-break:break-word;
}
.err{color:#fecaca}
.ok{color:#bbf7d0}
</style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="logo">&lt;/&gt;</div>
      Programmer's Picnic â€” JavaScript Editor
    </div>
    <div>
      <button class="btn primary" id="run">â–¶ Run</button>
      <button class="btn" id="stop">â›” Stop</button>
      <button class="btn" id="download">â¬‡ Download</button>
    </div>
  </div>

  <div class="grid">
    <!-- Editor -->
    <div class="card">
      <div class="header">
        <b>Editor</b>
        <span class="small">console.log â†’ Output</span>
      </div>
      <div class="editor-wrap">
        <pre class="gutter" id="gutter">1</pre>
        <textarea id="code" class="editor" spellcheck="false">
// Reverse digits of a number
function reverse(n){
  let r=0;
  while(n>0){
    r = r*10 + (n%10);
    n = Math.floor(n/10);
  }
  return r;
}

console.log(reverse(1213));
        </textarea>
      </div>
    </div>

    <!-- Output -->
    <div class="card">
      <div class="header">
        <b>Output</b>
        <div>
          <button class="btn" id="copy">ðŸ“‹ Copy</button>
          <button class="btn" id="clear">ðŸ§¹ Clear</button>
        </div>
      </div>
      <div id="out" class="out"></div>
    </div>
  </div>
</div>

<script>
const code = document.getElementById("code");
const out = document.getElementById("out");
const gutter = document.getElementById("gutter");
let worker = null;

function updateGutter(){
  const n = code.value.split("\n").length || 1;
  let s = "";
  for(let i=1;i<=n;i++) s += i + "\n";
  gutter.textContent = s;
  gutter.scrollTop = code.scrollTop;
}
code.addEventListener("input", updateGutter);
code.addEventListener("scroll", () => gutter.scrollTop = code.scrollTop);
updateGutter();

function runJS(src){
  return new Promise((res, rej) => {
    const blob = new Blob([`
      let log = [];
      console.log = (...a) => log.push(a.join(" "));
      onmessage = (e) => {
        try{
          eval(e.data);
          postMessage({ok:true, log});
        }catch(err){
          postMessage({ok:false, error: err.message, log});
        }
      };
    `], {type:"application/javascript"});

    const url = URL.createObjectURL(blob);
    worker = new Worker(url);

    const t = setTimeout(() => {
      worker.terminate();
      rej("Timeout (possible infinite loop)");
    }, 2000);

    worker.onmessage = (e) => {
      clearTimeout(t);
      res(e.data);
      worker.terminate();
    };

    worker.postMessage(src);
  });
}

document.getElementById("run").onclick = async () => {
  out.textContent = "";
  try{
    const r = await runJS(code.value);
    r.log.forEach(line => out.textContent += line + "\n");
    out.textContent += "\nâœ“ Done";
  }catch(e){
    out.innerHTML = '<span class="err">' + String(e) + '</span>';
  }
};

document.getElementById("stop").onclick = () => {
  if(worker) worker.terminate();
  out.textContent += "\nâ›” Stopped";
};

document.getElementById("clear").onclick = () => out.textContent = "";

document.getElementById("copy").onclick = async () => {
  try{
    await navigator.clipboard.writeText(out.innerText || "");
  }catch{
    prompt("Copy output:", out.innerText || "");
  }
};

document.getElementById("download").onclick = () => {
  const blob = new Blob([code.value || ""], {type:"text/javascript"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "script.js";
  a.click();
};
</script>
</body>
</html>